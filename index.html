<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Init Data Types</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            line-height: 1.6;
        }
        h1 {
            font-size: 20px;
            margin-bottom: 16px;
            color: var(--tg-theme-text-color, #000000);
        }
        h2 {
            font-size: 16px;
            margin: 20px 0 10px;
            color: var(--tg-theme-hint-color, #999999);
        }
        .card {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .field {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--tg-theme-hint-color, #e0e0e0);
        }
        .field:last-child {
            border-bottom: none;
        }
        .field-name {
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
        }
        .field-value {
            color: var(--tg-theme-link-color, #2481cc);
            text-align: right;
            max-width: 60%;
            word-break: break-all;
        }
        .field-type {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999999);
        }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        .badge.optional {
            background: var(--tg-theme-hint-color, #999999);
        }
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
            margin-top: 12px;
        }
        .comment { color: #6a9955; }
        .keyword { color: #569cd6; }
        .type { color: #4ec9b0; }
        .string { color: #ce9178; }
        .property { color: #9cdcfe; }
    </style>
</head>
<body>
    <h1>üì± Telegram Init Data</h1>

    <!-- Joriy ma'lumotlar -->
    <div class="card" id="current-data">
        <h2>Joriy Foydalanuvchi</h2>
        <div id="user-info">Yuklanmoqda...</div>
    </div>

    <!-- TypeScript Interface -->
    <h2>üìù TypeScript Interfacelar</h2>
    
    <div class="card">
        <h3>TelegramUser</h3>
        <div class="field">
            <span><span class="field-name">id</span> <span class="badge">required</span></span>
            <span class="field-type">number</span>
        </div>
        <div class="field">
            <span><span class="field-name">first_name</span> <span class="badge">required</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">last_name</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">username</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">language_code</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">is_premium</span> <span class="badge optional">optional</span></span>
            <span class="field-type">boolean</span>
        </div>
        <div class="field">
            <span><span class="field-name">allows_write_to_pm</span> <span class="badge optional">optional</span></span>
            <span class="field-type">boolean</span>
        </div>
        <div class="field">
            <span><span class="field-name">photo_url</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
    </div>

    <div class="card">
        <h3>WebAppChat</h3>
        <div class="field">
            <span><span class="field-name">id</span> <span class="badge">required</span></span>
            <span class="field-type">number</span>
        </div>
        <div class="field">
            <span><span class="field-name">type</span> <span class="badge">required</span></span>
            <span class="field-type">'group' | 'supergroup' | 'channel'</span>
        </div>
        <div class="field">
            <span><span class="field-name">title</span> <span class="badge">required</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">username</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">photo_url</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
    </div>

    <div class="card">
        <h3>WebAppInitData</h3>
        <div class="field">
            <span><span class="field-name">query_id</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">user</span> <span class="badge optional">optional</span></span>
            <span class="field-type">TelegramUser</span>
        </div>
        <div class="field">
            <span><span class="field-name">receiver</span> <span class="badge optional">optional</span></span>
            <span class="field-type">TelegramUser</span>
        </div>
        <div class="field">
            <span><span class="field-name">chat</span> <span class="badge optional">optional</span></span>
            <span class="field-type">WebAppChat</span>
        </div>
        <div class="field">
            <span><span class="field-name">chat_type</span> <span class="badge optional">optional</span></span>
            <span class="field-type">'sender' | 'private' | 'group' | 'supergroup' | 'channel'</span>
        </div>
        <div class="field">
            <span><span class="field-name">chat_instance</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">start_param</span> <span class="badge optional">optional</span></span>
            <span class="field-type">string</span>
        </div>
        <div class="field">
            <span><span class="field-name">can_send_after</span> <span class="badge optional">optional</span></span>
            <span class="field-type">number</span>
        </div>
        <div class="field">
            <span><span class="field-name">auth_date</span> <span class="badge">required</span></span>
            <span class="field-type">number</span>
        </div>
        <div class="field">
            <span><span class="field-name">hash</span> <span class="badge">required</span></span>
            <span class="field-type">string</span>
        </div>
    </div>

    <!-- Kod namunasi -->
    <h2>üíª Kod Namunasi</h2>
    <pre><code><span class="comment">// Telegram WebApp ni olish</span>
<span class="keyword">const</span> tg = window.Telegram.WebApp;

<span class="comment">// Init data ni olish (raw string)</span>
<span class="keyword">const</span> initData = tg.initData;

<span class="comment">// Init data unsafe (parse qilingan)</span>
<span class="keyword">const</span> initDataUnsafe = tg.initDataUnsafe;

<span class="comment">// Foydalanuvchi ma'lumotlari</span>
<span class="keyword">const</span> user = initDataUnsafe.<span class="property">user</span>;
<span class="keyword">if</span> (user) {
    console.log(<span class="string">'ID:'</span>, user.<span class="property">id</span>);
    console.log(<span class="string">'Ism:'</span>, user.<span class="property">first_name</span>);
    console.log(<span class="string">'Username:'</span>, user.<span class="property">username</span>);
    console.log(<span class="string">'Premium:'</span>, user.<span class="property">is_premium</span>);
}

<span class="comment">// Chat ma'lumotlari (guruhdan ochilsa)</span>
<span class="keyword">const</span> chat = initDataUnsafe.<span class="property">chat</span>;
<span class="keyword">if</span> (chat) {
    console.log(<span class="string">'Chat ID:'</span>, chat.<span class="property">id</span>);
    console.log(<span class="string">'Chat nomi:'</span>, chat.<span class="property">title</span>);
}

<span class="comment">// Start parametri (?startapp=...)</span>
<span class="keyword">const</span> startParam = initDataUnsafe.<span class="property">start_param</span>;

<span class="comment">// Tema ranglari</span>
<span class="keyword">const</span> themeParams = tg.<span class="property">themeParams</span>;
console.log(<span class="string">'Background:'</span>, themeParams.<span class="property">bg_color</span>);
console.log(<span class="string">'Text color:'</span>, themeParams.<span class="property">text_color</span>);</code></pre>

    <!-- Raw Init Data -->
    <h2>üîê Raw Init Data</h2>
    <div class="card">
        <pre id="raw-init-data" style="background: transparent; color: inherit; padding: 0;">Yuklanmoqda...</pre>
    </div>

    <script>
        // ============================================
        // TYPESCRIPT INTERFACE (JavaScript uchun JSDoc)
        // ============================================

        /**
         * @typedef {Object} TelegramUser
         * @property {number} id - Foydalanuvchi unikal ID
         * @property {string} first_name - Ism
         * @property {string} [last_name] - Familiya
         * @property {string} [username] - @username
         * @property {string} [language_code] - Til kodi (uz, en, ru)
         * @property {boolean} [is_premium] - Premium obunachi
         * @property {boolean} [added_to_attachment_menu] - Attachment menuga qo'shilgan
         * @property {boolean} [allows_write_to_pm] - PM ga yozishga ruxsat
         * @property {string} [photo_url] - Profil rasm URL
         */

        /**
         * @typedef {Object} WebAppChat
         * @property {number} id - Chat ID
         * @property {'group'|'supergroup'|'channel'} type - Chat turi
         * @property {string} title - Chat nomi
         * @property {string} [username] - Chat username
         * @property {string} [photo_url] - Chat rasm URL
         */

        /**
         * @typedef {Object} WebAppInitData
         * @property {string} [query_id] - Inline query ID
         * @property {TelegramUser} [user] - Joriy foydalanuvchi
         * @property {TelegramUser} [receiver] - Qabul qiluvchi (inline rejimda)
         * @property {WebAppChat} [chat] - Chat ma'lumotlari
         * @property {'sender'|'private'|'group'|'supergroup'|'channel'} [chat_type] - Chat turi
         * @property {string} [chat_instance] - Chat instance identifikatori
         * @property {string} [start_param] - ?startapp= parametri
         * @property {number} [can_send_after] - Xabar yuborish vaqti
         * @property {number} auth_date - Autentifikatsiya sanasi (Unix timestamp)
         * @property {string} hash - Ma'lumotlar hash (tekshirish uchun)
         */

        /**
         * @typedef {Object} ThemeParams
         * @property {string} [bg_color] - Orqa fon rangi
         * @property {string} [text_color] - Matn rangi
         * @property {string} [hint_color] - Hint matn rangi
         * @property {string} [link_color] - Havola rangi
         * @property {string} [button_color] - Tugma rangi
         * @property {string} [button_text_color] - Tugma matn rangi
         * @property {string} [secondary_bg_color] - Ikkinchi orqa fon
         * @property {string} [header_bg_color] - Header orqa fon
         * @property {string} [accent_text_color] - Accent matn rangi
         * @property {string} [section_bg_color] - Section orqa fon
         * @property {string} [section_header_text_color] - Section header rangi
         * @property {string} [subtitle_text_color] - Subtitle rangi
         * @property {string} [destructive_text_color] - Destructive rangi
         */

        // ============================================
        // INIT DATA NI OLISH VA KO'RSATISH
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            const tg = window.Telegram?.WebApp;
            
            if (!tg) {
                document.getElementById('user-info').innerHTML = 
                    '<p style="color: red;">‚ö†Ô∏è Telegram WebApp topilmadi. Bu sahifani Telegram Mini App ichida oching.</p>';
                document.getElementById('raw-init-data').textContent = 'Mavjud emas';
                return;
            }

            // WebApp ni tayyor qilish
            tg.ready();
            tg.expand();

            const user = tg.initDataUnsafe?.user;
            const chat = tg.initDataUnsafe?.chat;

            // Foydalanuvchi ma'lumotlarini ko'rsatish
            if (user) {
                let html = `
                    <div class="field">
                        <span class="field-name">ID</span>
                        <span class="field-value">${user.id}</span>
                    </div>
                    <div class="field">
                        <span class="field-name">Ism</span>
                        <span class="field-value">${user.first_name}</span>
                    </div>
                `;
                
                if (user.last_name) {
                    html += `
                        <div class="field">
                            <span class="field-name">Familiya</span>
                            <span class="field-value">${user.last_name}</span>
                        </div>
                    `;
                }
                
                if (user.username) {
                    html += `
                        <div class="field">
                            <span class="field-name">Username</span>
                            <span class="field-value">@${user.username}</span>
                        </div>
                    `;
                }
                
                if (user.language_code) {
                    html += `
                        <div class="field">
                            <span class="field-name">Til</span>
                            <span class="field-value">${user.language_code.toUpperCase()}</span>
                        </div>
                    `;
                }
                
                html += `
                    <div class="field">
                        <span class="field-name">Premium</span>
                        <span class="field-value">${user.is_premium ? '‚úÖ Ha' : '‚ùå Yo\'q'}</span>
                    </div>
                `;

                document.getElementById('user-info').innerHTML = html;
            } else {
                document.getElementById('user-info').innerHTML = 
                    '<p>Foydalanuvchi ma\'lumotlari mavjud emas</p>';
            }

            // Raw init data
            if (tg.initData) {
                document.getElementById('raw-init-data').textContent = 
                    decodeURIComponent(tg.initData);
            } else {
                document.getElementById('raw-init-data').textContent = 'Mavjud emas';
            }
        });

        // ============================================
        // FOYDALI FUNKSIYALAR
        // ============================================

        /**
         * Init data ni serverga yuborish
         * @param {string} initData - Raw init data string
         * @returns {Promise<boolean>}
         */
        async function validateInitData(initData) {
            const response = await fetch('/api/validate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ initData })
            });
            return response.ok;
        }

        /**
         * Foydalanuvchi ma'lumotlarini olish
         * @returns {TelegramUser|null}
         */
        function getUser() {
            return window.Telegram?.WebApp?.initDataUnsafe?.user || null;
        }

        /**
         * Chat ma'lumotlarini olish
         * @returns {WebAppChat|null}
         */
        function getChat() {
            return window.Telegram?.WebApp?.initDataUnsafe?.chat || null;
        }

        /**
         * Start parametrini olish
         * @returns {string|null}
         */
        function getStartParam() {
            return window.Telegram?.WebApp?.initDataUnsafe?.start_param || null;
        }

        /**
         * Tema ranglarini olish
         * @returns {ThemeParams}
         */
        function getThemeParams() {
            return window.Telegram?.WebApp?.themeParams || {};
        }
    </script>
</body>
</html>
</code>